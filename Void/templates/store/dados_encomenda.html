{% extends "base.html" %}
{% block content %}
{% load static %}

<style>
  .paypal-button {
    background-color: #ffc439; /* Cor de fundo amarela do PayPal */
    color: #111; /* Texto escuro para contraste */
    border: none; /* Sem borda */
    border-radius: 4px; /* Bordas arredondadas */
    padding: 10px 20px; /* Espaçamento interno */
    font-size: 16px; /* Tamanho da fonte */
    font-weight: bold; /* Fonte em negrito */
    text-transform: uppercase; /* Texto em caixa alta */
    cursor: pointer; /* Cursor em formato de ponteiro */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Sombra discreta */
    transition: background-color 0.3s ease; /* Transição suave de cor de fundo */
  }
  .paypal-button img {
    height: 24px; /* Height of the PayPal logo */
  }
  .paypal-button:hover {
    background-color: #e0a619; /* Cor mais escura no hover para efeito interativo */
  }
  .paypal-button:active {
    background-color: #c6931a; /* Cor ainda mais escura quando o botão é clicado */
  }
</style>


<div class="bg-gray-100" style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="container mx-auto mt-10">
    <div class="flex shadow-md my-10 border border-white border-2">

      <!-- Shopping cart section -->
      <div class="w-1/2 px-10 py-10 border-white" style="background-color: rgba(0, 0, 0, 0.5);">
        <div class="flex justify-between border-b pb-8">
          <h1 class="font-semibold text-2xl mt-4 ml-2 mr-2 text-white">Shopping Cart</h1>
          <h2 class="font-semibold text-xl mt-5 text-white">{{ cart_items_count }} Items</h2>
        </div>
        <a href="{% url 'store' %}" class="flex font-semibold text-indigo-600 text-sm mt-4 ml-2 text-white">
          Continue Shopping
        </a>
        <div class="relative overflow-x-auto shadow-md sm:rounded-lg text-white">
          <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 text-white">
            <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-700 text-white" style="background-color: rgba(0, 0, 0, 0.5);">
              <tr>
                <th scope="col" class="px-16 py-3 text-white">
                  <span class="sr-only">Image</span>
                </th>
                <th scope="col" class="px-6 py-3 text-white">
                  Product
                </th>
                <th scope="col" class="px-6 py-3 text-white">
                  Quantity
                </th>
                <th scope="col" class="px-6 py-3 text-white">
                  Price
                </th>
                <th scope="col" class="px-6 py-3 text-white">
                  Action
                </th>
              </tr>
            </thead>
            <tbody>
              {% for product in itens_carrinho %}
                <!-- Product rows -->
                <tr class="border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 text-white" style="background-color: rgba(0, 0, 0, 0.5);">
                  <td class="p-4">
                      <img src="{{product.produto.imagem.url}}" class="text-white w-16 md:w-32 max-w-full max-h-full" alt="{{product.produto.imagem.url}}">
                  </td>
                  <td class="px-6 py-4 font-semibold  dark:text-white text-white">
                      {{product.produto.nome}}
                      {% if product.tamanho_nome != 'unico' %}
                        Size: {{product.tamanho_nome}}
                      {% endif %} 
                  </td>
                  <td class="px-6 py-4 text-white">
                      <div class="flex items-center text-white">
                        {% if product.produto.categoria == 'roupa'%}
                          <a href="{% url 'remover_roupa_do_carrinho' product.produto_id%}">
                            <button class="text-white inline-flex items-center justify-center p-1 me-3 text-sm font-medium h-6 w-6 text-gray-500 border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700" type="button" style="background-color: rgba(0, 0, 0, 0.5);">
                                <span class="sr-only text-white">Quantity button</span>
                                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 2">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h16"/>
                                </svg>
                            </button>
                          </a>
                          {% else %}
                          <a href="{% url 'remover_do_carrinho' product.produto_id %}">
                            <button class="text-white inline-flex items-center justify-center p-1 me-3 text-sm font-medium h-6 w-6 text-gray-500 border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700" type="button" style="background-color: rgba(0, 0, 0, 0.5);">
                                <span class="sr-only text-white">Quantity button</span>
                                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 2">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h16"/>
                                </svg>
                            </button>
                          </a>
                          {%endif%}
                          <div>
                            <input type="number" id="product_{{product.produto.id}}" class="bg-gray-50 w-14 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block px-2.5 py-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 text-white" value="{{product.quantidade}}" required />
                            
                          </div>
                          {% if product.produto.categoria == 'roupa'%}
                              <a href="{% url 'adicionar_roupa_dentro_carrinho' product.produto.id%}">
                                  <button class="inline-flex items-center justify-center h-6 w-6 p-1 ms-3 text-sm font-medium text-gray-500 border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700 text-white" type="button" style="background-color: rgba(0, 0, 0, 0.5);">
                                      <span class="sr-only text-white">Quantity button</span>
                                      <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 18">
                                          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 1v16M1 9h16"/>
                                      </svg>
                                  </button>
                              </a>
                              
                            {% else %}
                          <a href="{% url 'adicionar_dentro_carrinho' product.produto.id %}">
                            <button class="inline-flex items-center justify-center h-6 w-6 p-1 ms-3 text-sm font-medium text-gray-500 border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700 text-white" type="button" style="background-color: rgba(0, 0, 0, 0.5);">
                                <span class="sr-only text-white">Quantity button</span>
                                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 18">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 1v16M1 9h16"/>
                                </svg>
                            </button>
                          </a>
                          {% endif %}
                      </div>
                  </td>
                  <td class="px-6 py-4 font-semibold dark:text-white text-white">
                    {{product.produto.preco}}€
                </td>
                  <td class="px-6 py-4 text-white">
                      <a href="{%url 'removerTdentro' product.produto_id %}" class="text-red font-medium text-red-600 dark:text-red-500 hover:underline">Remove</a>
                  </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>  
       
      </div>

      <!-- Checkout section -->
      <div class="w-1/2 px-8 py-10" style="background-color: rgba(0, 0, 0, 0.5);">
        
        <h1 class="font-semibold text-2xl border-b pb-8 mt-4 text-white">Checkout</h1>
        <form action="{% url 'create_payment' %}" onsubmit="return validarFormulario()" method="POST">
        {% comment %} <!-- Customer Information -->
        <div>
          <label for="customer-name" class="text-white font-medium inline-block mb-3 text-sm uppercase">Name</label>
          <input  type="text" id="customer-name" placeholder="Your Name" class="p-2 text-sm w-full">

          <label for="email" class="text-white font-medium inline-block mb-3 text-sm">E-mail</label>
          <input  type="email" id="email" placeholder="Your E-mail" class="p-2 text-sm w-full">

          <label for="address" class="text-white font-medium inline-block mb-3 text-sm uppercase mt-4">Address</label>
          <input  type="text" id="address" placeholder="Your Address" class="p-2 text-sm w-full">
          
          <label for="postal-code" class="text-white font-medium inline-block mb-3 text-sm uppercase mt-4">Postal Code</label>
          <input  type="text" id="postal-code" placeholder="Your Postal Code" class="p-2 text-sm w-full">
          
          <label for="city" class="text-white font-medium inline-block mb-3 text-sm uppercase mt-4">City</label>
          <input  type="text" id="city" placeholder="Your City" class="p-2 text-sm w-full">
        </div> {% endcomment %}
        <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
          The address that will be used, will be the one that you provide to PayPal, please chose the country that you live in the checkbox below!
      </p>
        <!-- Shipping section -->
        <div class="mt-4 text-white">
          <label class="text-white font-medium inline-block mb-3 text-sm uppercase">Shipping</label>
          <select id="country-selector" name='pais' class="text-black block p-2 text-gray-600 w-full text-sm">
            <option required selected disabled>Select your country</option>
            {% for country in countrys %}
            <option value="{{country.acronimo}}">{{country.name}}</option>
            {% endfor %}
          </select>
        </div>
        
        <!-- Promo code section -->
        <div class="py-10 text-white">
          <label for="promo" class="text-white font-semibold inline-block mb-3 text-sm uppercase mt-4">Promo Code</label>
          <input type="text" id="promo" placeholder="Enter your code" class="p-2 text-sm w-full">
        </div>
        <button class="text-white bg-red-500 hover:bg-red-600 px-5 py-2 text-sm text-white uppercase mt-4">Apply</button>
        
        <div class="border-t mt-8 text-white">
          <div class="text-white flex font-semibold justify-between py-6 text-sm uppercase">
            <span>Total</span>
            <span id="total">{{ total }}€</span>
          </div>
          <div class="text-white flex font-semibold justify-between py-6 text-sm uppercase">
            <span>With shipping</span>
            <span id="total_com_envio">{{ total }}€</span>
          </div>
          
            {% csrf_token %}
            <button type="submit" style="background-color: #FFC439;" class="flex items-center text-black justify-center gap-2 hover:bg-yellow-600 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
              <img src="../../static/src/img/paypal.png" alt="PayPal Logo" class="w-6 h-6">
              Pagar com PayPal
          </button>
        </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
    function validarFormulario() {
        var nome = document.getElementById("customer-name").value;
        var email = document.getElementById("email").value;
        var endereco = document.getElementById("address").value;
        var codigoPostal = document.getElementById("postal-code").value;
        var cidade = document.getElementById("city").value;
        var pais = document.getElementById("country-selector").value;

        // Verifique se os campos obrigatórios estão preenchidos
        if (nome === "" || email === "" || endereco === "" || codigoPostal === "" || cidade === "" || pais === "") {
            alert("Por favor, preencha todos os campos obrigatórios.");
            return false; // Impede o envio do formulário
        }

        // Verificar validade do e-mail
        var emailValido = /\S+@\S+\.\S+/.test(email);
        if (!emailValido) {
            alert("Por favor, insira um endereço de e-mail válido.");
            return false; // Impede o envio do formulário
        }

        // Verificar validade do código postal (um exemplo básico)
        var codigoPostalValido = /^[0-9]{4}-[0-9]{3}$/.test(codigoPostal);
        if (!codigoPostalValido) {
            alert("Por favor, insira um código postal válido no formato XXXX-XXX.");
            return false; // Impede o envio do formulário
        }

        // Adicione outras verificações de validação conforme necessário

        // Se todos os campos obrigatórios e válidos estão preenchidos, retorne true para permitir o envio do formulário
        return true;
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      const countrySelector = document.getElementById('country-selector');
      const totalElement = document.getElementById('total_com_envio'); // Use 'total_com_envio' para refletir o total com envio
      let totalBase = parseFloat(totalElement.textContent); // Supondo que 'totalElement' contenha apenas o número
      const ueCountries = ['AT', 'BE', 'BG', 'CY', 'CZ', 'DE', 'DK', 'EE', 'ES', 'FI', 'FR', 'GR', 'HR', 'HU', 'IE', 'IT', 'LT', 'LU', 'LV', 'MT', 'NL', 'PL', 'PT', 'RO', 'SE', 'SI', 'SK']; // Adicione todos os códigos dos países da UE
      
      countrySelector.addEventListener('change', function() {
        let shippingCost;
        if (this.value === 'PT') {
          shippingCost = 2.7;
        } else if (this.value === 'US') {
          shippingCost = 5.7;
        } else if (ueCountries.includes(this.value)) {
          shippingCost = 4.5; // Supondo que este seja o valor para países da UE
        } else {
          shippingCost = 6.5;
        }
    
        // Calcula o novo total
        const newTotal = totalBase + shippingCost;
    
        // Atualiza o texto do total na página
        totalElement.textContent = `${newTotal.toFixed(2)}€`;
      });
    })

    </script>
    
    
{% endblock %}
